<!-- Instructor Dashboard -->
<div class="instructor-dashboard">
    <!-- Dashboard Header -->
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <h1 class="dashboard-heading">
                <i class="fas fa-chalkboard-teacher me-2"></i> Instructor Dashboard
            </h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active">Instructor Dashboard</li>
                </ol>
            </nav>
        </div>
        <div class="col-md-4 text-end">
            <span class="badge rounded-pill" style="background-color: #ff9800;">
                Instructor Access
            </span>
        </div>
    </div>

    <!-- Instructor Profile Summary -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card profile-summary h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="profile-img">
                            <% if (user.profile_image) { %>
                                <% 
                                    let imgSrc = user.profile_image;
                                    if (!imgSrc.startsWith('/')) {
                                        imgSrc = `/storage/profile_images/${imgSrc.split('/').pop()}`;
                                    }
                                %>
                                <img src="<%= imgSrc %>" alt="Profile Image" class="img-fluid rounded-circle">
                            <% } else { %>
                                <i class="fas fa-user-circle"></i>
                            <% } %>
                        </div>
                        <h3><%= user.first_name %> <%= user.last_name %></h3>
                        <p class="text-muted"><%= profile && profile.department ? profile.department : 'Department not set' %></p>
                    </div>
                    <div class="d-grid gap-2">
                        <a href="/instructor/profile" class="btn btn-primary">
                            <i class="fas fa-user me-2"></i> View Profile
                        </a>
                        <a href="/instructor/update-profile" class="btn btn-outline-primary">
                            <i class="fas fa-edit me-2"></i> Update Profile
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="card stats-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-book stats-icon"></i>
                            <h2><%= stats.totalCourses %></h2>
                            <p class="text-muted mb-0">Assigned Courses</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card stats-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-user-graduate stats-icon"></i>
                            <h2><%= stats.totalStudents %></h2>
                            <p class="text-muted mb-0">Total Students</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card stats-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-bullhorn stats-icon"></i>
                            <h2><%= stats.totalAnnouncements %></h2>
                            <p class="text-muted mb-0">Announcements</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Quick Actions</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <a href="/instructor/announcements/create" class="btn btn-success d-block">
                                        <i class="fas fa-plus-circle me-2"></i> New Announcement
                                    </a>
                                </div>
                                <div class="col-md-6">
                                    <a href="/instructor/courses" class="btn btn-primary d-block">
                                        <i class="fas fa-book-open me-2"></i> View My Courses
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- My Courses Section -->
    <div class="instructor-courses mt-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-book-open me-2"></i> My Courses</h5>
                <div>
                    <a href="/instructor/courses" class="btn btn-primary btn-sm">
                        <i class="fas fa-th-list me-1"></i> View All
                    </a>
                </div>
            </div>
            <div class="card-body">
                <% if(courses && courses.length > 0) { %>
                    <div class="course-grid">
                        <% courses.forEach(course => { %>
                            <div class="card course-card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0"><%= course.title %></h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-3">
                                        <span class="badge rounded-pill bg-secondary"><%= course.course_code %></span>
                                        <span class="badge rounded-pill bg-info"><%= course.credit_hours %> Credits</span>
                                    </div>
                                    <p class="card-text mb-3"><%= course.description.substring(0, 100) %>...</p>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted"><i class="fas fa-user-graduate me-1"></i> <%= course.student_count %> Students</span>
                                        <span class="text-muted"><i class="fas fa-calendar-alt me-1"></i> <%= course.semester_name %></span>
                                    </div>
                                </div>
                                <div class="card-footer bg-white border-0">
                                    <a href="/instructor/courses/<%= course.id %>" class="btn btn-primary d-block">
                                        <i class="fas fa-eye me-1"></i> Manage Course
                                    </a>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } else { %>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> You are not assigned to any courses yet.
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Recent Announcements -->
    <div class="mt-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-bullhorn me-2"></i> My Recent Announcements</h5>
                <div>
                    <a href="/instructor/announcements/create" class="btn btn-success btn-sm">
                        <i class="fas fa-plus me-1"></i> Create New
                    </a>
                    <a href="/instructor/announcements" class="btn btn-primary btn-sm ms-2">
                        <i class="fas fa-th-list me-1"></i> View All
                    </a>
                </div>
            </div>
            <div class="card-body">
                <% if(announcements && announcements.length > 0) { %>
                    <div class="list-group">
                        <% announcements.forEach(announcement => { %>
                            <div class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1"><%= announcement.title %></h5>
                                    <small><%= new Date(announcement.created_at).toLocaleDateString() %></small>
                                </div>
                                <p class="mb-1 announcement-preview"><%= announcement.content %></p>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <% if(announcement.target_type === 'all') { %>
                                        <span class="badge badge-target-all">All Users</span>
                                    <% } else if(announcement.target_type === 'instructors') { %>
                                        <span class="badge badge-target-instructors">Instructors</span>
                                    <% } else if(announcement.target_type === 'students') { %>
                                        <span class="badge badge-target-students">Students</span>
                                    <% } else { %>
                                        <span class="badge badge-target-course">Course: <%= announcement.course_code %></span>
                                    <% } %>
                                    <a href="/instructor/announcements/edit/<%= announcement.id %>" class="btn btn-sm btn-primary">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } else { %>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> You haven't created any announcements yet.
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Calendar and Upcoming Events -->
    <div class="mt-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i> Upcoming Deadlines</h5>
            </div>
            <div class="card-body">
                <% if(upcomingAssignments && upcomingAssignments.length > 0) { %>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Course</th>
                                    <th>Type</th>
                                    <th>Title</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% upcomingAssignments.forEach(assignment => { %>
                                    <tr>
                                        <td><strong><%= assignment.course_name || assignment.course_code || 'Unknown Course' %></strong></td>
                                        <td><span class="badge <%= assignment.type === 'quiz' ? 'bg-info' : 'bg-primary' %>"><%= assignment.type === 'quiz' ? 'Quiz' : 'Assignment' %></span></td>
                                        <td><%= assignment.title || 'Untitled' %></td>
                                        <td>
                                            <% 
                                                const dueDate = new Date(assignment.due_date);
                                                const today = new Date();
                                                const diffTime = dueDate - today;
                                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                            %>
                                            <span class="<%= diffDays <= 3 ? 'text-danger' : diffDays <= 7 ? 'text-warning' : '' %>">
                                                <%= dueDate.toLocaleDateString() %>
                                                <% if(diffDays <= 7) { %>
                                                    (<%= diffDays %> days left)
                                                <% } %>
                                            </span>
                                        </td>
                                        <td>
                                            <% if(assignment.type === 'quiz') { %>
                                                <a href="/instructor/courses/<%= assignment.course_id %>/quizzes/<%= assignment.id || assignment.quiz_id %>/results" class="btn btn-sm btn-primary">
                                                    <i class="fas fa-chart-bar"></i> Results
                                                </a>
                                            <% } else { %>
                                                <a href="/instructor/courses/<%= assignment.course_id %>/assignments/<%= assignment.id || assignment.assignment_id %>/grade" class="btn btn-sm btn-primary">
                                                    <i class="fas fa-check-square"></i> Grade
                                                </a>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> No upcoming assignments or deadlines.
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Account Management -->
    <div class="mt-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user-cog me-2"></i> Account Management</h5>
            </div>
            <div class="card-body">
                <div class="list-group">
                    <a href="/auth/change-password" class="list-group-item list-group-item-action">
                        <i class="fas fa-key me-2"></i> Change Password
                    </a>
                    <a href="/auth/forgot-password" class="list-group-item list-group-item-action">
                        <i class="fas fa-unlock-alt me-2"></i> Reset Password
                    </a>
                </div>
            </div>
        </div>
    </div>
</div> 