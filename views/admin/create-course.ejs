<div class="container mt-4">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-plus me-2"></i> Create New Course
                    </h5>
                </div>

                <div class="card-body">
                    <% if (locals.errors && errors.length > 0) { %>
                        <div class="alert alert-danger">
                            <ul class="mb-0">
                                <% errors.forEach(error => { %>
                                    <li><%= error.msg %></li>
                                <% }); %>
                            </ul>
                        </div>
                    <% } %>

                    <form action="/admin/courses/create" method="POST">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="course_code" class="form-label">Course Code</label>
                                <input type="text" class="form-control" id="course_code" name="course_code" 
                                    value="<%= locals.formData ? formData.course_code : '' %>" required>
                                <div class="form-text">Example: CS101, MATH202, etc.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="title" class="form-label">Course Title</label>
                                <input type="text" class="form-control" id="title" name="title"
                                    value="<%= locals.formData ? formData.title : '' %>" required>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="credit_hours" class="form-label">Credit Hours</label>
                                <input type="number" class="form-control" id="credit_hours" name="credit_hours"
                                    value="<%= locals.formData ? formData.credit_hours : '3' %>" min="1" max="6" required>
                            </div>
                            <div class="col-md-6">
                                <label for="semester_id" class="form-label">Semester</label>
                                <select class="form-select" id="semester_id" name="semester_id" required>
                                    <option value="">Select a semester</option>
                                    <% if (semesters && semesters.length > 0) { %>
                                        <% semesters.forEach(semester => { %>
                                            <option value="<%= semester.semester_id %>" 
                                                <%= locals.formData && formData.semester_id == semester.semester_id ? 'selected' : '' %>
                                                <%= semester.is_active ? '(Active)' : '' %>>
                                                <%= semester.semester_name %> 
                                                (<%= new Date(semester.start_date).toLocaleDateString() %> to 
                                                <%= new Date(semester.end_date).toLocaleDateString() %>)
                                            </option>
                                        <% }); %>
                                    <% } %>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Course Description</label>
                            <textarea class="form-control" id="description" name="description" rows="4"><%= locals.formData ? formData.description : '' %></textarea>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="is_active" class="form-label">Status</label>
                                <select class="form-select" id="is_active" name="is_active" required>
                                    <option value="true" <%= locals.formData && formData.is_active === 'true' ? 'selected' : '' %>>Active</option>
                                    <option value="false" <%= locals.formData && formData.is_active === 'false' ? 'selected' : '' %>>Inactive</option>
                                </select>
                            </div>
                        </div>

                        <hr class="my-4">

                        <div class="mb-3">
                            <label class="form-label">Assign Instructors</label>
                            <div class="instructor-selection">
                                <% if (instructors && instructors.length > 0) { %>
                                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                                        <% instructors.forEach(instructor => { %>
                                            <div class="col">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" 
                                                        name="instructors" value="<%= instructor.user_id %>" 
                                                        id="instructor-<%= instructor.user_id %>"
                                                        <%= locals.formData && formData.instructors && 
                                                            (Array.isArray(formData.instructors) 
                                                                ? formData.instructors.includes(instructor.user_id.toString()) 
                                                                : formData.instructors === instructor.user_id.toString())
                                                            ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="instructor-<%= instructor.user_id %>">
                                                        <%= instructor.first_name %> <%= instructor.last_name %>
                                                        <small class="d-block text-muted"><%= instructor.department || 'No Department' %></small>
                                                    </label>
                                                </div>
                                            </div>
                                        <% }); %>
                                    </div>
                                <% } else { %>
                                    <div class="alert alert-info">
                                        No instructors available. <a href="/admin/users/create">Create an instructor</a> first.
                                    </div>
                                <% } %>
                            </div>
                        </div>

                        <div class="d-flex mt-4">
                            <button type="submit" class="btn btn-primary me-2">Create Course</button>
                            <a href="/admin/courses" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

