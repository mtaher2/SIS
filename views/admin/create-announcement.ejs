<div class="container mt-4">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-bullhorn me-2"></i> Create New Announcement
                    </h5>
                </div>

                <div class="card-body">
                    <% if (locals.errors && errors.length > 0) { %>
                        <div class="alert alert-danger">
                            <ul class="mb-0">
                                <% errors.forEach(error => { %>
                                    <li><%= error.msg %></li>
                                <% }); %>
                            </ul>
                        </div>
                    <% } %>

                    <form action="/admin/announcements/create" method="POST">
                        <div class="mb-3">
                            <label for="title" class="form-label">Announcement Title</label>
                            <input type="text" class="form-control" id="title" name="title" 
                                value="<%= locals.formData ? formData.title : '' %>" required>
                        </div>

                        <div class="mb-3">
                            <label for="content" class="form-label">Announcement Content</label>
                            <textarea class="form-control" id="content" name="content" rows="6" required><%= locals.formData ? formData.content : '' %></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="target_type" class="form-label">Target Audience</label>
                            <select class="form-select" id="target_type" name="target_type" required>
                                <option value="">Select target audience</option>
                                <option value="all" <%= locals.formData && formData.target_type === 'all' ? 'selected' : '' %>>All Users</option>
                                <option value="student" <%= locals.formData && formData.target_type === 'student' ? 'selected' : '' %>>All Students</option>
                                <option value="instructor" <%= locals.formData && formData.target_type === 'instructor' ? 'selected' : '' %>>All Instructors</option>
                                <option value="course" <%= locals.formData && formData.target_type === 'course' ? 'selected' : '' %>>Specific Course</option>
                            </select>
                        </div>

                        <div id="course-selection" class="mb-3" style="display: none;">
                            <label for="course_id" class="form-label">Select Course</label>
                            <select class="form-select" id="course_id" name="course_id">
                                <option value="">Select a course</option>
                                <% if (locals.courses && courses.length > 0) { %>
                                    <% courses.forEach(course => { %>
                                        <option value="<%= course.course_id %>" 
                                            <%= locals.formData && formData.course_id == course.course_id ? 'selected' : '' %>>
                                            <%= course.course_code %> - <%= course.title %>
                                        </option>
                                    <% }); %>
                                <% } %>
                            </select>
                        </div>

                        <div class="d-flex mt-4">
                            <button type="submit" class="btn btn-primary me-2">Create Announcement</button>
                            <a href="/admin/announcements" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const targetTypeSelect = document.getElementById('target_type');
        const courseSelection = document.getElementById('course-selection');
        
        function updateCourseSelection() {
            if (targetTypeSelect.value === 'course') {
                courseSelection.style.display = 'block';
                document.getElementById('course_id').setAttribute('required', 'required');
            } else {
                courseSelection.style.display = 'none';
                document.getElementById('course_id').removeAttribute('required');
            }
        }
        
        // Initial update
        updateCourseSelection();
        
        // Update whenever selection changes
        targetTypeSelect.addEventListener('change', updateCourseSelection);
    });
</script> 