<!-- Unofficial Transcript -->
<div class="transcript">
    <!-- Page Header -->
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <h1 class="dashboard-heading">
                <i class="fas fa-file-alt me-2"></i> Unofficial Transcript
            </h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/student/dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item active">Transcript</li>
                </ol>
            </nav>
        </div>
        <div class="col-md-4 text-end">
            <button class="btn btn-primary" onclick="generatePDF()">
                <i class="fas fa-download me-2"></i> Download PDF
            </button>
        </div>
    </div>

    <!-- Transcript Content -->
    <div class="card" id="transcriptContent">
        <div class="card-body">
            <!-- Header -->
            <div class="text-center mb-4">
                <h2>UNOFFICIAL TRANSCRIPT</h2>
                <p class="text-muted">Generated on <%= new Date().toLocaleDateString() %></p>
            </div>

            <!-- Student Information -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Student Information</h5>
                    <table class="table table-sm">
                        <tr>
                            <th>Name:</th>
                            <td><%= user.first_name %> <%= user.last_name %></td>
                        </tr>
                        <tr>
                            <th>Student ID:</th>
                            <td><%= user.student_id %></td>
                        </tr>
                        <tr>
                            <th>Program:</th>
                            <td><%= profile.program || 'Not specified' %></td>
                        </tr>
                        <tr>
                            <th>Email:</th>
                            <td><%= user.email %></td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <h5>Academic Summary</h5>
                    <table class="table table-sm">
                        <tr>
                            <th>Current GPA:</th>
                            <td><%= gpa.current ? gpa.current.toFixed(2) : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th>Semester GPA:</th>
                            <td><%= gpa.semester ? gpa.semester.toFixed(2) : 'N/A' %></td>
                        </tr>
                        <tr>
                            <th>Total Credits:</th>
                            <td><%= totalCredits %></td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td><%= user.status || 'Active' %></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Course History -->
            <div class="mb-4">
                <h5>Course History</h5>
                <% Object.entries(courseHistory).forEach(([semester, courses]) => { %>
                    <div class="semester-section mb-4">
                        <h6 class="semester-header"><%= semester %></h6>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Course Code</th>
                                    <th>Course Name</th>
                                    <th>Credits</th>
                                    <th>Grade</th>
                                    <th>Grade Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% courses.forEach(course => { %>
                                    <tr>
                                        <td><%= course.course_code %></td>
                                        <td><%= course.course_name %></td>
                                        <td><%= course.credit_hours %></td>
                                        <td><%= course.letter_grade || 'In Progress' %></td>
                                        <td><%= course.grade_points ? course.grade_points.toFixed(2) : 'N/A' %></td>
                                    </tr>
                                <% }) %>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="2"><strong>Semester GPA</strong></td>
                                    <td colspan="3"><%= gpaHistory.find(g => g.semester_name === semester)?.gpa.toFixed(2) || 'N/A' %></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                <% }) %>
            </div>

            <!-- Legend -->
            <div class="row">
                <div class="col-12">
                    <h5>Grade Scale</h5>
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>Letter Grade</th>
                                <th>Percentage</th>
                                <th>Grade Points</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>A</td><td>90-100%</td><td>4.0</td></tr>
                            <tr><td>A-</td><td>87-89%</td><td>3.7</td></tr>
                            <tr><td>B+</td><td>84-86%</td><td>3.3</td></tr>
                            <tr><td>B</td><td>80-83%</td><td>3.0</td></tr>
                            <tr><td>B-</td><td>77-79%</td><td>2.7</td></tr>
                            <tr><td>C+</td><td>74-76%</td><td>2.3</td></tr>
                            <tr><td>C</td><td>70-73%</td><td>2.0</td></tr>
                            <tr><td>C-</td><td>67-69%</td><td>1.7</td></tr>
                            <tr><td>D+</td><td>64-66%</td><td>1.3</td></tr>
                            <tr><td>D</td><td>60-63%</td><td>1.0</td></tr>
                            <tr><td>F</td><td>0-59%</td><td>0.0</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-4">
                <p class="text-muted">
                    This is an unofficial transcript. For official transcripts, please contact the Registrar's Office.
                </p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function generatePDF() {
    const element = document.getElementById('transcriptContent');
    const opt = {
        margin: 1,
        filename: 'unofficial_transcript.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(element).save();
}
</script> 